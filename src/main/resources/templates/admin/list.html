<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title th:text="${section == 'intake' ? 'PhÃ²ng tiáº¿p nháº­n' : (section == 'assessment' ? 'PhÃ²ng tháº©m Ä‘á»‹nh tÃ­n dá»¥ng' : 'PhÃ²ng giáº£i ngÃ¢n')}">Quáº£n trá»‹ há»“ sÆ¡</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="container">
  <!-- Dynamic title based on section -->
  <h1 th:text="${section == 'intake' ? 'ğŸ“¥ PhÃ²ng Tiáº¿p Nháº­n' : (section == 'assessment' ? 'ğŸ” PhÃ²ng Tháº©m Äá»‹nh TÃ­n Dá»¥ng' : 'ğŸ’° PhÃ²ng Giáº£i NgÃ¢n')}">
    Quáº£n trá»‹ há»“ sÆ¡
  </h1>

  <nav class="tabs">
    <a class="tab" href="/admin/dashboard">Dashboard</a>
    <a class="tab" th:class="${section=='intake'} ? 'tab active' : 'tab'" href="/admin/intake">PhÃ²ng tiáº¿p nháº­n</a>
    <a class="tab" th:class="${section=='assessment'} ? 'tab active' : 'tab'" href="/admin/assessment">PhÃ²ng tháº©m Ä‘á»‹nh</a>
    <a class="tab" th:class="${section=='disbursement'} ? 'tab active' : 'tab'" href="/admin/disbursement">PhÃ²ng giáº£i ngÃ¢n</a>
  </nav>

  <!-- Department description -->
  <div style="background: #0f172a; padding: 12px 16px; border-radius: 8px; margin: 16px 0; border-left: 4px solid var(--accent);">
    <div th:if="${section == 'intake'}">
      <strong>ğŸ“‹ Nhiá»‡m vá»¥:</strong> Tiáº¿p nháº­n vÃ  kiá»ƒm tra tÃ­nh Ä‘áº§y Ä‘á»§ cá»§a há»“ sÆ¡ vay tÃ­n dá»¥ng
      <br><small style="opacity: 0.8;">Há»“ sÆ¡ á»Ÿ tráº¡ng thÃ¡i: <span class="badge SUBMITTED">SUBMITTED</span></small>
    </div>
    <div th:if="${section == 'assessment'}">
      <strong>ğŸ” Nhiá»‡m vá»¥:</strong> Tháº©m Ä‘á»‹nh tÃ­n dá»¥ng, kiá»ƒm tra blacklist vÃ  Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh phÃª duyá»‡t
      <br><small style="opacity: 0.8;">Há»“ sÆ¡ á»Ÿ tráº¡ng thÃ¡i: <span class="badge UNDER_REVIEW">UNDER_REVIEW</span>, <span class="badge ASSESSED">ASSESSED</span></small>
    </div>
    <div th:if="${section == 'disbursement'}">
      <strong>ğŸ’° Nhiá»‡m vá»¥:</strong> Thá»±c hiá»‡n giáº£i ngÃ¢n cho cÃ¡c khoáº£n vay Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t
      <br><small style="opacity: 0.8;">Há»“ sÆ¡ á»Ÿ tráº¡ng thÃ¡i: <span class="badge APPROVED">APPROVED</span>, <span class="badge DISBURSED">DISBURSED</span></small>
    </div>
  </div>

  <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
  <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

  <!-- Statistics for current department -->
  <div style="display: flex; gap: 16px; margin: 16px 0; flex-wrap: wrap;">
    <div style="background: #1f2937; padding: 12px 16px; border-radius: 8px; flex: 1; min-width: 200px;">
      <div style="font-size: 1.5em; font-weight: bold; color: var(--accent);" th:text="${#lists.size(apps)}">0</div>
      <div style="font-size: 0.9em; opacity: 0.8;">
        <span th:if="${section == 'intake'}">Há»“ sÆ¡ chá» tiáº¿p nháº­n</span>
        <span th:if="${section == 'assessment'}">Há»“ sÆ¡ cáº§n xá»­ lÃ½</span>
        <span th:if="${section == 'disbursement'}">Há»“ sÆ¡ cáº§n giáº£i ngÃ¢n</span>
      </div>
    </div>

    <div th:if="${#lists.size(apps) > 0}" style="background: #1f2937; padding: 12px 16px; border-radius: 8px; flex: 1; min-width: 200px;">
      <div style="font-size: 1.2em; font-weight: bold; color: #f59e0b;">ğŸ¯ HÃ nh Ä‘á»™ng tiáº¿p theo</div>
      <div style="font-size: 0.9em; opacity: 0.8; margin-top: 4px;">
        <span th:if="${section == 'intake'}">Kiá»ƒm tra vÃ  tiáº¿p nháº­n há»“ sÆ¡</span>
        <span th:if="${section == 'assessment'}">Tháº©m Ä‘á»‹nh vÃ  Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh</span>
        <span th:if="${section == 'disbursement'}">Thá»±c hiá»‡n giáº£i ngÃ¢n</span>
      </div>
    </div>
  </div>

  <table>
    <thead>
    <tr>
      <th>ID</th><th>KhÃ¡ch hÃ ng</th><th>Sá»‘ tiá»n</th><th>Ká»³ háº¡n</th><th>Tráº¡ng thÃ¡i</th><th>HÃ nh Ä‘á»™ng</th>
    </tr>
    </thead>
    <tbody>
    <tr th:if="${#lists.isEmpty(apps)}">
      <td colspan="6" style="text-align:center;opacity:.7;padding:24px;">
        <div style="font-size: 1.2em; margin-bottom: 8px;">
          <span th:if="${section == 'intake'}">ğŸ“­ KhÃ´ng cÃ³ há»“ sÆ¡ nÃ o chá» tiáº¿p nháº­n</span>
          <span th:if="${section == 'assessment'}">ğŸ“­ KhÃ´ng cÃ³ há»“ sÆ¡ nÃ o cáº§n tháº©m Ä‘á»‹nh</span>
          <span th:if="${section == 'disbursement'}">ğŸ“­ KhÃ´ng cÃ³ há»“ sÆ¡ nÃ o cáº§n giáº£i ngÃ¢n</span>
        </div>
        <small>
          <span th:if="${section == 'intake'}">Há»“ sÆ¡ má»›i sáº½ hiá»ƒn thá»‹ táº¡i Ä‘Ã¢y khi khÃ¡ch hÃ ng ná»™p Ä‘Æ¡n</span>
          <span th:if="${section == 'assessment'}">Há»“ sÆ¡ sáº½ chuyá»ƒn Ä‘áº¿n Ä‘Ã¢y sau khi Ä‘Æ°á»£c tiáº¿p nháº­n</span>
          <span th:if="${section == 'disbursement'}">Há»“ sÆ¡ sáº½ chuyá»ƒn Ä‘áº¿n Ä‘Ã¢y sau khi Ä‘Æ°á»£c phÃª duyá»‡t</span>
        </small>
      </td>
    </tr>

    <tr th:each="a : ${apps}">
      <td>
        <strong th:text="${a.id}"></strong>
        <div style="font-size: 0.8em; opacity: 0.7;">
          #<span th:text="${a.id}"></span>
        </div>
      </td>
      <td>
        <div th:text="${a.customer.fullName}" style="font-weight: 600;"></div>
        <div style="font-size: 0.8em; opacity: 0.7;" th:text="${a.customer.phone}"></div>
      </td>
      <td>
        <div th:text="${#numbers.formatInteger(a.amount,3,'POINT')}" style="font-weight: 600; color: var(--accent);"></div>
        <div style="font-size: 0.8em; opacity: 0.7;">VND</div>
      </td>
      <td>
        <div th:text="${a.termMonths}" style="font-weight: 600;"></div>
        <div style="font-size: 0.8em; opacity: 0.7;">thÃ¡ng</div>
      </td>
      <td>
        <span class="badge" th:text="${a.status}" th:class="'badge ' + ${a.status.name()}"></span>
        <div style="font-size: 0.8em; opacity: 0.7; margin-top: 4px;">
          <span th:text="${#temporals.format(a.submittedAt, 'dd/MM HH:mm')}"></span>
        </div>
      </td>
      <td class="actions">
        <!-- NÃºt Chi tiáº¿t theo phÃ²ng hiá»‡n táº¡i -->
        <a class="btn btn-outline"
           th:href="@{'/admin/' + ${section} + '/app/' + ${a.id}}"
           style="margin-right: 8px;">
          ğŸ“‹ Chi tiáº¿t
        </a>

        <!-- Quick actions based on status and department -->
        <div th:if="${section == 'intake' and a.status.name() == 'SUBMITTED'}" style="display: inline;">
          <form th:action="@{'/admin/' + ${a.id} + '/intake/accept'}" method="post" style="display: inline;">
            <button class="btn btn-primary btn-sm" type="submit" style="font-size: 0.8em; padding: 6px 10px;">
              âš¡ Tiáº¿p nháº­n
            </button>
          </form>
        </div>

        <div th:if="${section == 'assessment' and a.status.name() == 'ASSESSED'}" style="display: inline;">
          <a class="btn btn-success btn-sm"
             th:href="@{'/admin/assessment/app/' + ${a.id}}"
             style="font-size: 0.8em; padding: 6px 10px;">
            âš¡ Quyáº¿t Ä‘á»‹nh
          </a>
        </div>

        <div th:if="${section == 'disbursement' and a.status.name() == 'APPROVED'}" style="display: inline;">
          <form th:action="@{'/admin/' + ${a.id} + '/disburse'}" method="post" style="display: inline;">
            <button class="btn btn-warning btn-sm" type="submit" style="font-size: 0.8em; padding: 6px 10px;">
              âš¡ Giáº£i ngÃ¢n
            </button>
          </form>
        </div>
      </td>
    </tr>
    </tbody>
  </table>

  <!-- Footer actions -->
  <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #374151; display: flex; justify-content: space-between; align-items: center;">
    <div>
      <a class="link" href="/admin/dashboard">ğŸ  Vá» Dashboard</a>
      <span style="margin: 0 12px; opacity: 0.5;">â€¢</span>
      <span style="opacity: 0.7; font-size: 0.9em;">
        <span th:if="${section == 'intake'}">PhÃ²ng Tiáº¿p Nháº­n</span>
        <span th:if="${section == 'assessment'}">PhÃ²ng Tháº©m Äá»‹nh TÃ­n Dá»¥ng</span>
        <span th:if="${section == 'disbursement'}">PhÃ²ng Giáº£i NgÃ¢n</span>
      </span>
    </div>

    <!-- Quick navigation -->
    <div style="display: flex; gap: 8px;">
      <a th:if="${section != 'intake'}" class="btn btn-outline btn-sm" href="/admin/intake">ğŸ“¥ Tiáº¿p nháº­n</a>
      <a th:if="${section != 'assessment'}" class="btn btn-outline btn-sm" href="/admin/assessment">ğŸ” Tháº©m Ä‘á»‹nh</a>
      <a th:if="${section != 'disbursement'}" class="btn btn-outline btn-sm" href="/admin/disbursement">ğŸ’° Giáº£i ngÃ¢n</a>
    </div>
  </div>
</div>

<style>
.btn-sm {
  padding: 6px 12px;
  font-size: 0.8em;
}
</style>
</body>
</html>