<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Quản trị hồ sơ vay</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="container">
  <h1>Quản trị hồ sơ (4 bước)</h1>
  <table>
    <thead>
    <tr>
      <th>ID</th><th>KH</th><th>Số tiền</th><th>Kỳ hạn</th><th>Trạng thái</th><th>Hành động</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="a : ${apps}">
      <td th:text="${a.id}"></td>
      <td th:text="${a.customer.fullName}"></td>
      <td th:text="${#numbers.formatInteger(a.amount,3,'POINT')}"></td>
      <td th:text="${a.termMonths}"></td>
      <td><span class="badge" th:text="${a.status}"></span></td>
      <td class="actions">
        <!-- B1: Tiếp nhận -->
        <form th:if="${a.status.name() == 'SUBMITTED'}"
              th:action="@{'/admin/' + ${a.id} + '/review'}" method="post">
          <button>Tiếp nhận</button>
        </form>

        <!-- B2: Thẩm định -->
        <form th:if="${a.status.name() == 'UNDER_REVIEW' or a.status.name() == 'SUBMITTED'}"
              th:action="@{'/admin/' + ${a.id} + '/assessment'}" method="post">
          <input name="note" placeholder="Ghi chú thẩm định"/>
          <button>Hoàn tất thẩm định</button>
        </form>

        <!-- B3: Phê duyệt / Từ chối -->
        <form th:if="${a.status.name() == 'ASSESSED'}"
              th:action="@{'/admin/' + ${a.id} + '/approve'}" method="post">
          <input name="note" placeholder="Ghi chú phê duyệt"/>
          <button>Phê duyệt</button>
        </form>
        <form th:if="${a.status.name() == 'ASSESSED' or a.status.name() == 'UNDER_REVIEW'}"
              th:action="@{'/admin/' + ${a.id} + '/reject'}" method="post">
          <input name="reason" placeholder="Lý do từ chối" required/>
          <button>Từ chối</button>
        </form>

        <!-- B4: Giải ngân -->
        <form th:if="${a.status.name() == 'APPROVED'}"
              th:action="@{'/admin/' + ${a.id} + '/disburse'}" method="post">
          <button>Giải ngân</button>
        </form>

        <a class="link" th:href="@{'/status/' + ${a.id}}">Xem</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>
</body>
</html>
