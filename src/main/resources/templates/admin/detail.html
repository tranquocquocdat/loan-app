<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Chi tiết hồ sơ #[[${app.id}]]</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="container">
    <h1>Hồ sơ #<span th:text="${app.id}"></span> — <span class="badge" th:text="${app.status}"></span></h1>

    <nav class="tabs">
        <a class="tab" href="/admin/intake" th:classappend="${section=='intake'} ? ' active'">Phòng tiếp nhận</a>
        <a class="tab" href="/admin/assessment" th:classappend="${section=='assessment'} ? ' active'">Phòng thẩm định</a>
        <a class="tab" href="/admin/disbursement" th:classappend="${section=='disbursement'} ? ' active'">Phòng giải ngân</a>
    </nav>

    <div class="grid2">
        <div class="card">
            <h3>Thông tin khách hàng</h3>
            <p><b>Họ tên:</b> <span th:text="${app.customer.fullName}"></span></p>
            <p><b>Email:</b> <span th:text="${app.customer.email}"></span></p>
            <p><b>Điện thoại:</b> <span th:text="${app.customer.phone}"></span></p>
        </div>
        <div class="card">
            <h3>Chi tiết khoản vay</h3>
            <p><b>Số tiền:</b> <span th:text="${#numbers.formatInteger(app.amount,3,'POINT')}"></span></p>
            <p><b>Kỳ hạn (tháng):</b> <span th:text="${app.termMonths}"></span></p>
            <p><b>Mục đích:</b> <span th:text="${app.purpose}"></span></p>
            <p><b>Thu nhập/tháng:</b> <span th:text="${#numbers.formatInteger(app.monthlyIncome,3,'POINT')}"></span></p>
        </div>
    </div>

    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <h3>Hành động</h3>
    <div class="actions">
        <!-- 1) Chi tiết: đang ở chi tiết rồi -->

        <!-- 2) Chuyển đến phòng kế bên -->
        <form th:action="@{'/admin/' + ${app.id} + '/next'}" method="post" style="display:inline">
            <input type="hidden" name="redirectTo" th:value="@{'/admin/' + ${section} + '/app/' + ${app.id}}"/>
            <button class="btn"
                    th:disabled="${
                (section=='intake'       and app.status.name()!='SUBMITTED') or
                (section=='assessment'   and !(app.status.name()=='UNDER_REVIEW' or app.status.name()=='ASSESSED')) or
                (section=='disbursement' and app.status.name()!='APPROVED')
              }">Chuyển đến phòng kế bên</button>
        </form>

        <!-- 3) Từ chối (lý do) -->
        <form th:action="@{'/admin/' + ${app.id} + '/reject'}" method="post" style="display:inline;margin-left:6px">
            <input class="input" name="reason" placeholder="Lý do từ chối"
                   th:disabled="${app.status.name()=='DISBURSED'}" required/>
            <input type="hidden" name="redirectTo" th:value="@{'/admin/' + ${section} + '/app/' + ${app.id}}"/>
            <button class="btn btn-danger" th:disabled="${app.status.name()=='DISBURSED'}">Từ chối</button>
        </form>
    </div>

    <div style="margin-top:16px">
        <a class="link" th:href="@{'/admin/' + ${section}}">← Quay lại danh sách</a>
    </div>
</div>
</body>
</html>
