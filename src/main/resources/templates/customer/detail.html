<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Chi tiáº¿t há»“ sÆ¡ #[[${app.id}]]</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .customer-header {
            background: linear-gradient(135deg, #22d3ee, #0891b2);
            padding: 20px;
            border-radius: 12px;
            color: white;
            margin-bottom: 24px;
        }
        .status-timeline {
            background: #1f2937;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #374151;
        }
        .timeline-item {
            display: flex;
            align-items: flex-start;
            margin: 16px 0;
            padding: 12px 0;
            border-bottom: 1px solid #374151;
        }
        .timeline-item:last-child {
            border-bottom: none;
        }
        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
            font-size: 1.2em;
        }
        .timeline-icon.completed {
            background: #22c55e;
            color: white;
        }
        .timeline-icon.current {
            background: #22d3ee;
            color: #083344;
            animation: pulse 2s infinite;
        }
        .timeline-icon.pending {
            background: #374151;
            color: #9ca3af;
        }
        .timeline-icon.rejected {
            background: #ef4444;
            color: white;
        }
        .timeline-content {
            flex: 1;
        }
        .timeline-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .timeline-time {
            font-size: 0.9em;
            opacity: 0.7;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .info-card {
            background: #1f2937;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #374151;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 4px 0;
        }
        .info-label {
            color: #9ca3af;
            font-weight: 500;
        }
        .info-value {
            font-weight: 600;
            color: #e5e7eb;
        }
        @media (max-width: 768px) {
            .info-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Customer Header -->
    <div class="customer-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="margin: 0;">ğŸ“‹ Há»“ sÆ¡ vay #<span th:text="${app.id}"></span></h1>
                <p style="margin: 8px 0 0 0; opacity: 0.9;">
                    Tráº¡ng thÃ¡i: <span class="badge" th:text="${app.status}" style="background: rgba(255,255,255,0.2); color: white;"></span>
                </p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 1.5em; font-weight: bold;" th:text="${#numbers.formatInteger(app.amount, 3, 'POINT')}">0</div>
                <div style="opacity: 0.8; font-size: 0.9em;">VND</div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div style="margin-bottom: 20px;">
        <a href="/my-applications" class="btn btn-outline">â† Vá» danh sÃ¡ch há»“ sÆ¡</a>
        <a th:if="${app.status.name() == 'APPROVED' or app.status.name() == 'DISBURSED'}"
           th:href="@{'/admin/' + ${app.id} + '/contract'}" class="btn btn-outline">ğŸ“„ Xem há»£p Ä‘á»“ng</a>
    </div>

    <!-- Status Timeline -->
    <div class="status-timeline">
        <h3 style="margin: 0 0 20px 0;">ğŸš€ Tiáº¿n trÃ¬nh xá»­ lÃ½ há»“ sÆ¡</h3>

        <div class="timeline-item">
            <div class="timeline-icon completed">âœ“</div>
            <div class="timeline-content">
                <div class="timeline-title">Ná»™p há»“ sÆ¡</div>
                <div class="timeline-time" th:text="${#temporals.format(app.submittedAt, 'dd/MM/yyyy HH:mm')}"></div>
                <div style="font-size: 0.9em; opacity: 0.8; margin-top: 4px;">
                    Há»“ sÆ¡ Ä‘Ã£ Ä‘Æ°á»£c ná»™p thÃ nh cÃ´ng vÃ o há»‡ thá»‘ng
                </div>
            </div>
        </div>

        <div class="timeline-item">
            <div th:class="'timeline-icon ' + (${app.status.name() == 'SUBMITTED'} ? 'current' : (${app.reviewedAt != null} ? 'completed' : 'pending'))">
                <span th:if="${app.reviewedAt != null}">âœ“</span>
                <span th:if="${app.reviewedAt == null and app.status.name() == 'SUBMITTED'}">â³</span>
                <span th:if="${app.reviewedAt == null and app.status.name() != 'SUBMITTED'}">ğŸ“‹</span>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">PhÃ²ng tiáº¿p nháº­n xá»­ lÃ½</div>
                <div th:if="${app.reviewedAt}" class="timeline-time"
                     th:text="${#temporals.format(app.reviewedAt, 'dd/MM/yyyy HH:mm')}"></div>
                <div style="font-size: 0.9em; opacity: 0.8; margin-top: 4px;">
                    <span th:if="${app.reviewedAt != null}">Há»“ sÆ¡ Ä‘Ã£ Ä‘Æ°á»£c tiáº¿p nháº­n vÃ  chuyá»ƒn sang tháº©m Ä‘á»‹nh</span>
                    <span th:if="${app.reviewedAt == null and app.status.name() == 'SUBMITTED'}">Äang kiá»ƒm tra tÃ­nh Ä‘áº§y Ä‘á»§ cá»§a há»“ sÆ¡</span>
                    <span th:if="${app.reviewedAt == null and app.status.name() != 'SUBMITTED'}">Chá» xá»­ lÃ½</span>
                </div>
            </div>
        </div>

        <div class="timeline-item">
            <div th:class="'timeline-icon ' + (${app.status.name() == 'UNDER_REVIEW'} ? 'current' : (${app.assessedAt != null} ? 'completed' : 'pending'))">
                <span th:if="${app.assessedAt != null}">âœ“</span>
                <span th:if="${app.assessedAt == null and app.status.name() == 'UNDER_REVIEW'}">ğŸ”</span>
                <span th:if="${app.assessedAt == null and app.status.name() != 'UNDER_REVIEW'}">ğŸ”</span>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Tháº©m Ä‘á»‹nh tÃ­n dá»¥ng</div>
                <div th:if="${app.assessedAt}" class="timeline-time"
                     th:text="${#temporals.format(app.assessedAt, 'dd/MM/yyyy HH:mm')}"></div>
                <div style="font-size: 0.9em; opacity: 0.8; margin-top: 4px;">
                    <span th:if="${app.assessedAt != null}">ÄÃ£ hoÃ n táº¥t tháº©m Ä‘á»‹nh, chá» quyáº¿t Ä‘á»‹nh phÃª duyá»‡t</span>
                    <span th:if="${app.assessedAt == null and app.status.name() == 'UNDER_REVIEW'}">Äang thá»±c hiá»‡n tháº©m Ä‘á»‹nh tÃ­n dá»¥ng</span>
                    <span th:if="${app.assessedAt == null and app.status.name() != 'UNDER_REVIEW' and app.reviewedAt != null}">Chá» tháº©m Ä‘á»‹nh</span>
                </div>
            </div>
        </div>

        <div class="timeline-item">
            <div th:class="'timeline-icon ' +
                (${app.status.name() == 'ASSESSED'} ? 'current' :
                (${app.approvedAt != null} ? 'completed' :
                (${app.rejectedAt != null} ? 'rejected' : 'pending')))">
                <span th:if="${app.approvedAt != null}">âœ“</span>
                <span th:if="${app.rejectedAt != null}">âŒ</span>
                <span th:if="${app.approvedAt == null and app.rejectedAt == null and app.status.name() == 'ASSESSED'}">âš–ï¸</span>
                <span th:if="${app.approvedAt == null and app.rejectedAt == null and app.status.name() != 'ASSESSED'}">âš–ï¸</span>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Quyáº¿t Ä‘á»‹nh phÃª duyá»‡t</div>
                <div th:if="${app.approvedAt}" class="timeline-time"
                     th:text="${#temporals.format(app.approvedAt, 'dd/MM/yyyy HH:mm')}"></div>
                <div th:if="${app.rejectedAt}" class="timeline-time"
                     th:text="${#temporals.format(app.rejectedAt, 'dd/MM/yyyy HH:mm')}"></div>
                <div style="font-size: 0.9em; opacity: 0.8; margin-top: 4px;">
                    <span th:if="${app.approvedAt != null}">ğŸ‰ Há»“ sÆ¡ Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t! Chá» giáº£i ngÃ¢n</span>
                    <span th:if="${app.rejectedAt != null}">âŒ Há»“ sÆ¡ Ä‘Ã£ bá»‹ tá»« chá»‘i</span>
                    <span th:if="${app.approvedAt == null and app.rejectedAt == null and app.status.name() == 'ASSESSED'}">Äang xem xÃ©t vÃ  Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh</span>
                    <span th:if="${app.approvedAt == null and app.rejectedAt == null and app.status.name() != 'ASSESSED' and app.assessedAt != null}">Chá» quyáº¿t Ä‘á»‹nh</span>
                </div>
            </div>
        </div>

        <div th:if="${app.status.name() != 'REJECTED'}" class="timeline-item">
            <div th:class="'timeline-icon ' + (${app.status.name() == 'APPROVED'} ? 'current' : (${app.disbursedAt != null} ? 'completed' : 'pending'))">
                <span th:if="${app.disbursedAt != null}">âœ“</span>
                <span th:if="${app.disbursedAt == null and app.status.name() == 'APPROVED'}">ğŸ’°</span>
                <span th:if="${app.disbursedAt == null and app.status.name() != 'APPROVED'}">ğŸ’°</span>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Giáº£i ngÃ¢n</div>
                <div th:if="${app.disbursedAt}" class="timeline-time"
                     th:text="${#temporals.format(app.disbursedAt, 'dd/MM/yyyy HH:mm')}"></div>
                <div style="font-size: 0.9em; opacity: 0.8; margin-top: 4px;">
                    <span th:if="${app.disbursedAt != null}">âœ¨ Khoáº£n vay Ä‘Ã£ Ä‘Æ°á»£c giáº£i ngÃ¢n thÃ nh cÃ´ng!</span>
                    <span th:if="${app.disbursedAt == null and app.status.name() == 'APPROVED'}">Äang thá»±c hiá»‡n thá»§ tá»¥c giáº£i ngÃ¢n</span>
                    <span th:if="${app.disbursedAt == null and app.status.name() != 'APPROVED'}">Chá» giáº£i ngÃ¢n</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Details -->
    <div class="info-grid">
        <div class="info-card">
            <h3 style="margin: 0 0 16px 0;">ğŸ‘¤ ThÃ´ng tin cÃ¡ nhÃ¢n</h3>
            <div class="info-row">
                <span class="info-label">Há» tÃªn:</span>
                <span class="info-value" th:text="${app.customer.fullName}"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Email:</span>
                <span class="info-value" th:text="${app.customer.email}"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Äiá»‡n thoáº¡i:</span>
                <span class="info-value" th:text="${app.customer.phone}"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Thu nháº­p/thÃ¡ng:</span>
                <span class="info-value" th:text="${#numbers.formatInteger(app.monthlyIncome, 3, 'POINT')} + ' VND'"></span>
            </div>
        </div>

        <div class="info-card">
            <h3 style="margin: 0 0 16px 0;">ğŸ’° ThÃ´ng tin khoáº£n vay</h3>
            <div class="info-row">
                <span class="info-label">Sá»‘ tiá»n:</span>
                <span class="info-value" style="color: #22d3ee;" th:text="${#numbers.formatInteger(app.amount, 3, 'POINT')} + ' VND'"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Thá»i háº¡n:</span>
                <span class="info-value" th:text="${app.termMonths} + ' thÃ¡ng'"></span>
            </div>
            <div class="info-row">
                <span class="info-label">Má»¥c Ä‘Ã­ch:</span>
                <span class="info-value" th:text="${app.purpose != null ? app.purpose : 'KhÃ´ng xÃ¡c Ä‘á»‹nh'}"></span>
            </div>
            <div class="info-row">
                <span class="info-label">NgÃ y ná»™p:</span>
                <span class="info-value" th:text="${#temporals.format(app.submittedAt, 'dd/MM/yyyy')}"></span>
            </div>
        </div>
    </div>

    <!-- Additional Information -->
    <div th:if="${app.assessmentNote != null or app.approvalNote != null or app.rejectionReason != null}">
        <div class="info-card">
            <h3 style="margin: 0 0 16px 0;">ğŸ“ Ghi chÃº tá»« ngÃ¢n hÃ ng</h3>

            <div th:if="${app.assessmentNote != null}" style="margin: 12px 0; padding: 12px; background: #0f172a; border-radius: 6px; border-left: 4px solid #22d3ee;">
                <strong style="color: #22d3ee;">Káº¿t quáº£ tháº©m Ä‘á»‹nh:</strong>
                <p style="margin: 8px 0 0 0;" th:text="${app.assessmentNote}"></p>
            </div>

            <div th:if="${app.approvalNote != null}" style="margin: 12px 0; padding: 12px; background: rgba(34, 197, 94, 0.1); border-radius: 6px; border-left: 4px solid #22c55e;">
                <strong style="color: #22c55e;">Ghi chÃº phÃª duyá»‡t:</strong>
                <p style="margin: 8px 0 0 0;" th:text="${app.approvalNote}"></p>
            </div>

            <div th:if="${app.rejectionReason != null}" style="margin: 12px 0; padding: 12px; background: rgba(239, 68, 68, 0.1); border-radius: 6px; border-left: 4px solid #ef4444;">
                <strong style="color: #ef4444;">LÃ½ do tá»« chá»‘i:</strong>
                <p style="margin: 8px 0 0 0;" th:text="${app.rejectionReason}"></p>
            </div>
        </div>
    </div>

    <!-- Action buttons -->
    <div style="margin-top: 30px; text-align: center;">
        <div th:if="${app.status.name() == 'SUBMITTED' or app.status.name() == 'UNDER_REVIEW'}">
            <div style="padding: 16px; background: rgba(34, 211, 238, 0.1); border-radius: 8px; border: 1px solid #22d3ee; margin-bottom: 16px;">
                <h4 style="margin: 0 0 8px 0; color: #22d3ee;">â³ Há»“ sÆ¡ Ä‘ang Ä‘Æ°á»£c xá»­ lÃ½</h4>
                <p style="margin: 0; opacity: 0.8;">
                    NgÃ¢n hÃ ng sáº½ liÃªn há»‡ vá»›i báº¡n trong vÃ²ng 1-3 ngÃ y lÃ m viá»‡c.
                    Vui lÃ²ng kiá»ƒm tra email vÃ  Ä‘iá»‡n thoáº¡i thÆ°á»ng xuyÃªn.
                </p>
            </div>
        </div>

        <div th:if="${app.status.name() == 'APPROVED'}">
            <div style="padding: 16px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid #22c55e; margin-bottom: 16px;">
                <h4 style="margin: 0 0 8px 0; color: #22c55e;">ğŸ‰ ChÃºc má»«ng! Há»“ sÆ¡ Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t</h4>
                <p style="margin: 0; opacity: 0.8;">
                    NgÃ¢n hÃ ng sáº½ liÃªn há»‡ Ä‘á»ƒ hoÃ n táº¥t thá»§ tá»¥c giáº£i ngÃ¢n.
                    Vui lÃ²ng chuáº©n bá»‹ cÃ¡c giáº¥y tá» cáº§n thiáº¿t.
                </p>
            </div>
        </div>

        <div th:if="${app.status.name() == 'DISBURSED'}">
            <div style="padding: 16px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid #16a34a; margin-bottom: 16px;">
                <h4 style="margin: 0 0 8px 0; color: #16a34a;">âœ¨ HoÃ n táº¥t! Khoáº£n vay Ä‘Ã£ Ä‘Æ°á»£c giáº£i ngÃ¢n</h4>
                <p style="margin: 0; opacity: 0.8;">
                    Cáº£m Æ¡n báº¡n Ä‘Ã£ tin tÆ°á»Ÿng dá»‹ch vá»¥ cá»§a chÃºng tÃ´i.
                    Vui lÃ²ng kiá»ƒm tra tÃ i khoáº£n vÃ  liÃªn há»‡ náº¿u cÃ³ tháº¯c máº¯c.
                </p>
            </div>
        </div>

        <a href="/my-applications" class="btn btn-primary">â† Vá» danh sÃ¡ch há»“ sÆ¡</a>
        <a href="/apply" class="btn btn-outline">ğŸ“ Ná»™p há»“ sÆ¡ má»›i</a>
    </div>

    <!-- Help section -->
    <div style="margin-top: 40px; padding: 20px; background: #0f172a; border-radius: 12px; border: 1px solid #374151;">
        <h4>â“ Cáº§n há»— trá»£ vá» há»“ sÆ¡ nÃ y?</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
            <div>
                <strong>ğŸ“ Hotline:</strong><br>
                <span style="color: #22d3ee;">1900-123-456</span><br>
                <small style="opacity: 0.7;">Nháº¯c mÃ£ há»“ sÆ¡ #<span th:text="${app.id}"></span></small>
            </div>
            <div>
                <strong>ğŸ“§ Email:</strong><br>
                <span style="color: #22d3ee;">support@bank.com</span>
            </div>
            <div>
                <strong>ğŸ¢ Chi nhÃ¡nh:</strong><br>
                <span>TÃ¬m chi nhÃ¡nh gáº§n nháº¥t</span>
            </div>
        </div>
    </div>
</div>

<script>
// Auto refresh every 30 seconds to check for status updates
setTimeout(() => location.reload(), 30000);
</script>
</body>
</html>