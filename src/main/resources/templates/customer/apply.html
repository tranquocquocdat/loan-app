<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>ƒêƒÉng k√Ω vay t√≠n d·ª•ng</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
    .form-section {
      background: #1f2937;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
      border: 1px solid #374151;
    }
    .loan-calculator {
      background: #0f172a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid #374151;
    }
    .calculator-result {
      font-size: 1.1em;
      font-weight: bold;
      color: #22d3ee;
      margin-top: 8px;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
    }
    .customer-info {
      background: linear-gradient(135deg, #22d3ee, #0891b2);
      padding: 16px;
      border-radius: 8px;
      color: white;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="container">
    <!-- Customer Header -->
    <div class="customer-info">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="margin: 0;">üìù ƒêƒÉng k√Ω vay t√≠n d·ª•ng</h1>
                <p style="margin: 8px 0 0 0; opacity: 0.9;">ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n: <strong th:text="${username}"></strong></p>
            </div>
            <a href="/my-applications" class="btn btn-outline" style="border-color: white; color: white;">
                ‚Üê Quay l·∫°i h·ªì s∆°
            </a>
        </div>
    </div>

    <form method="post" action="/apply" id="loanForm">
        <div class="form-grid">
            <!-- Th√¥ng tin c√° nh√¢n -->
            <div class="form-section">
                <h3>üë§ Th√¥ng tin c√° nh√¢n</h3>
                <div class="form-group">
                    <label>H·ªç v√† t√™n <span style="color: #ef4444;">*</span></label>
                    <input name="fullName" required placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß"/>
                </div>
                <div class="form-group">
                    <label>Email <span style="color: #ef4444;">*</span></label>
                    <input name="email" type="email" required placeholder="example@email.com"/>
                </div>
                <div class="form-group">
                    <label>S·ªë ƒëi·ªán tho·∫°i <span style="color: #ef4444;">*</span></label>
                    <input name="phone" required placeholder="09xxxxxxxx"/>
                </div>
                <div class="form-group">
                    <label>Thu nh·∫≠p h√†ng th√°ng (VND) <span style="color: #ef4444;">*</span></label>
                    <input name="monthlyIncome" type="number" step="100000" value="15000000" required
                           placeholder="15,000,000" id="monthlyIncomeInput"/>
                    <small style="opacity: 0.7; margin-top: 4px; display: block;">
                        üí° Thu nh·∫≠p √≠t nh·∫•t 5 tri·ªáu VND/th√°ng
                    </small>
                </div>
            </div>

            <!-- Th√¥ng tin kho·∫£n vay -->
            <div class="form-section">
                <h3>üí∞ Th√¥ng tin kho·∫£n vay</h3>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn vay (VND) <span style="color: #ef4444;">*</span></label>
                    <input name="amount" type="number" step="1000000" value="50000000" required
                           placeholder="50,000,000" id="amountInput" min="1000000" max="2000000000"/>
                    <small style="opacity: 0.7; margin-top: 4px; display: block;">
                        üí° T·ª´ 1 tri·ªáu ƒë·∫øn 2 t·ª∑ VND
                    </small>
                </div>

                <div class="form-group">
                    <label>Th·ªùi h·∫°n vay <span style="color: #ef4444;">*</span></label>
                    <select name="termMonths" id="termSelect" required>
                        <option value="6">6 th√°ng</option>
                        <option value="12" selected>12 th√°ng</option>
                        <option value="18">18 th√°ng</option>
                        <option value="24">24 th√°ng</option>
                        <option value="36">36 th√°ng</option>
                        <option value="48">48 th√°ng</option>
                        <option value="60">60 th√°ng</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>M·ª•c ƒë√≠ch vay</label>
                    <select name="purpose">
                        <option value="">-- Ch·ªçn m·ª•c ƒë√≠ch --</option>
                        <option value="Ti√™u d√πng c√° nh√¢n">Ti√™u d√πng c√° nh√¢n</option>
                        <option value="Mua xe">Mua xe</option>
                        <option value="S·ª≠a ch·ªØa nh√†">S·ª≠a ch·ªØa nh√†</option>
                        <option value="Kinh doanh">Kinh doanh</option>
                        <option value="Gi√°o d·ª•c">Gi√°o d·ª•c</option>
                        <option value="Y t·∫ø">Y t·∫ø</option>
                        <option value="Kh√°c">Kh√°c</option>
                    </select>
                </div>

                <!-- Loan Calculator -->
                <div class="loan-calculator">
                    <h4 style="margin: 0 0 12px 0;">üßÆ ∆Ø·ªõc t√≠nh kho·∫£n tr·∫£ h√†ng th√°ng</h4>
                    <div id="calculatorResult" class="calculator-result">
                        Kho·∫£n tr·∫£/th√°ng: <span id="monthlyPayment">0 VND</span>
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.7; margin-top: 4px;">
                        L√£i su·∫•t ∆∞·ªõc t√≠nh: 12%/nƒÉm
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="form-section">
            <h3>üìã X√°c nh·∫≠n th√¥ng tin</h3>
            <div style="background: #0f172a; padding: 16px; border-radius: 8px; margin: 12px 0;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" required id="agreementCheck"/>
                    <span>T√¥i x√°c nh·∫≠n c√°c th√¥ng tin tr√™n l√† ch√≠nh x√°c v√† ƒë·ªìng √Ω v·ªõi
            <a href="#" class="link">ƒëi·ªÅu kho·∫£n d·ªãch v·ª•</a> c·ªßa ng√¢n h√†ng
          </span>
                </label>
            </div>

            <div id="eligibilityCheck" style="margin: 12px 0; padding: 12px; border-radius: 8px; display: none;">
                <!-- Dynamic eligibility message -->
            </div>

            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 20px;">
                <button type="button" onclick="history.back()" class="btn btn-outline">
                    ‚Üê H·ªßy b·ªè
                </button>
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    üì§ N·ªôp h·ªì s∆° vay
                </button>
            </div>
        </div>
    </form>

    <!-- Help Section -->
    <div style="margin-top: 30px; padding: 16px; background: #0f172a; border-radius: 8px; border: 1px solid #374151;">
        <h4>üí° L∆∞u √Ω quan tr·ªçng</h4>
        <ul style="margin: 12px 0; opacity: 0.8;">
            <li>Th·ªùi gian x√©t duy·ªát: 1-3 ng√†y l√†m vi·ªác</li>
            <li>Ng√¢n h√†ng c√≥ th·ªÉ y√™u c·∫ßu b·ªï sung gi·∫•y t·ªù</li>
            <li>L√£i su·∫•t ch√≠nh th·ª©c s·∫Ω ƒë∆∞·ª£c th√¥ng b√°o khi ph√™ duy·ªát</li>
            <li>Kh√¥ng m·∫•t ph√≠ ƒëƒÉng k√Ω h·ªì s∆°</li>
        </ul>
    </div>
</div>

<script>
// Loan Calculator
function calculateLoan() {
  const amount = parseFloat(document.getElementById('amountInput').value) || 0;
  const termMonths = parseInt(document.getElementById('termSelect').value) || 12;
  const monthlyIncome = parseFloat(document.getElementById('monthlyIncomeInput').value) || 0;

  if (amount > 0 && termMonths > 0) {
    // Simple calculation with 12% annual rate (1% monthly)
    const monthlyRate = 0.01;
    const factor = Math.pow(1 + monthlyRate, termMonths);
    const monthlyPayment = amount * (monthlyRate * factor) / (factor - 1);

    document.getElementById('monthlyPayment').textContent =
      new Intl.NumberFormat('vi-VN').format(Math.round(monthlyPayment)) + ' VND';

    // Check eligibility
    checkEligibility(monthlyPayment, monthlyIncome, amount);
  }
}

function checkEligibility(monthlyPayment, monthlyIncome, amount) {
  const eligibilityDiv = document.getElementById('eligibilityCheck');
  const submitBtn = document.getElementById('submitBtn');

  if (monthlyIncome <= 0) {
    eligibilityDiv.style.display = 'none';
    return;
  }

  const dtiRatio = monthlyPayment / monthlyIncome;
  eligibilityDiv.style.display = 'block';

  if (dtiRatio > 0.33) {
    eligibilityDiv.className = 'alert alert-error';
    eligibilityDiv.innerHTML = '‚ö†Ô∏è <strong>L∆∞u √Ω:</strong> Kho·∫£n tr·∫£ h√†ng th√°ng chi·∫øm ' +
      Math.round(dtiRatio * 100) + '% thu nh·∫≠p. Khuy·∫øn kh√≠ch kh√¥ng qu√° 33% ƒë·ªÉ ƒë·∫£m b·∫£o kh·∫£ nƒÉng tr·∫£ n·ª£.';
  } else if (amount < 1000000) {
    eligibilityDiv.className = 'alert alert-error';
    eligibilityDiv.innerHTML = '‚ùå S·ªë ti·ªÅn vay t·ªëi thi·ªÉu l√† 1,000,000 VND';
  } else if (monthlyIncome < 5000000) {
    eligibilityDiv.className = 'alert alert-warning';
    eligibilityDiv.innerHTML = '‚ö†Ô∏è Thu nh·∫≠p khuy·∫øn kh√≠ch t·ª´ 5,000,000 VND tr·ªü l√™n';
  } else {
    eligibilityDiv.className = 'alert alert-success';
    eligibilityDiv.innerHTML = '‚úÖ <strong>Tuy·ªát v·ªùi!</strong> H·ªì s∆° c·ªßa b·∫°n ƒë√°p ·ª©ng c√°c ƒëi·ªÅu ki·ªán c∆° b·∫£n. ' +
      'Kho·∫£n tr·∫£ ch·ªâ chi·∫øm ' + Math.round(dtiRatio * 100) + '% thu nh·∫≠p.';
  }
}

// Add event listeners
document.getElementById('amountInput').addEventListener('input', calculateLoan);
document.getElementById('termSelect').addEventListener('change', calculateLoan);
document.getElementById('monthlyIncomeInput').addEventListener('input', calculateLoan);

// Initial calculation
calculateLoan();

// Form validation
document.getElementById('loanForm').addEventListener('submit', function(e) {
  const amount = parseFloat(document.getElementById('amountInput').value);
  const monthlyIncome = parseFloat(document.getElementById('monthlyIncomeInput').value);

  if (amount < 1000000) {
    alert('S·ªë ti·ªÅn vay t·ªëi thi·ªÉu l√† 1,000,000 VND');
    e.preventDefault();
    return;
  }

  if (monthlyIncome < 1000000) {
    alert('Thu nh·∫≠p h√†ng th√°ng t·ªëi thi·ªÉu l√† 1,000,000 VND');
    e.preventDefault();
    return;
  }

  if (!document.getElementById('agreementCheck').checked) {
    alert('Vui l√≤ng x√°c nh·∫≠n ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n d·ªãch v·ª•');
    e.preventDefault();
    return;
  }

  // Show loading state
  const submitBtn = document.getElementById('submitBtn');
  submitBtn.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
  submitBtn.disabled = true;
});
</script>
</body>
</html>