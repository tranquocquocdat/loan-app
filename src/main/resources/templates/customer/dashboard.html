<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Há»“ sÆ¡ vay cá»§a tÃ´i</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .customer-header {
            background: linear-gradient(135deg, #22d3ee, #0891b2);
            padding: 20px;
            border-radius: 12px;
            color: white;
            margin-bottom: 24px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .stat-card {
            background: #1f2937;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid #374151;
        }
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 4px;
        }
        .quick-actions {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .app-card {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            transition: all 0.2s;
        }
        .app-card:hover {
            border-color: #22d3ee;
            box-shadow: 0 4px 12px rgba(34, 211, 238, 0.1);
        }
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .app-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #22d3ee;
        }
        .app-status {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .progress-bar {
            background: #374151;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #0891b2);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Customer Header -->
    <div class="customer-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="margin: 0;">ğŸ‘¤ Xin chÃ o, <span th:text="${username}"></span>!</h1>
                <p style="margin: 8px 0 0 0; opacity: 0.9;">Quáº£n lÃ½ há»“ sÆ¡ vay tÃ­n dá»¥ng cá»§a báº¡n</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 1.5em; font-weight: bold;" th:text="${totalApplications}">0</div>
                <div style="opacity: 0.8; font-size: 0.9em;">Tá»•ng há»“ sÆ¡</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <a href="/apply" class="btn btn-primary">ğŸ“ Ná»™p há»“ sÆ¡ má»›i</a>
        <a href="/my-applications" class="btn btn-outline">ğŸ”„ LÃ m má»›i</a>
        <a href="/logout" class="btn btn-outline">ğŸšª ÄÄƒng xuáº¥t</a>
    </div>

    <!-- Notifications -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card" style="border-left: 4px solid #0891b2;">
            <div class="stat-number" style="color: #0891b2;" th:text="${submitted}">0</div>
            <div class="stat-label">Chá» xá»­ lÃ½</div>
        </div>
        <div class="stat-card" style="border-left: 4px solid #ca8a04;">
            <div class="stat-number" style="color: #ca8a04;" th:text="${underReview}">0</div>
            <div class="stat-label">Äang tháº©m Ä‘á»‹nh</div>
        </div>
        <div class="stat-card" style="border-left: 4px solid #059669;">
            <div class="stat-number" style="color: #059669;" th:text="${approved}">0</div>
            <div class="stat-label">ÄÃ£ phÃª duyá»‡t</div>
        </div>
        <div class="stat-card" style="border-left: 4px solid #16a34a;">
            <div class="stat-number" style="color: #16a34a;" th:text="${disbursed}">0</div>
            <div class="stat-label">ÄÃ£ giáº£i ngÃ¢n</div>
        </div>
        <div class="stat-card" style="border-left: 4px solid #dc2626;" th:if="${rejected > 0}">
            <div class="stat-number" style="color: #dc2626;" th:text="${rejected}">0</div>
            <div class="stat-label">ÄÃ£ tá»« chá»‘i</div>
        </div>
    </div>

    <!-- Applications List -->
    <h2>ğŸ“‹ Há»“ sÆ¡ vay cá»§a báº¡n</h2>

    <div th:if="${#lists.isEmpty(apps)}" style="text-align: center; padding: 40px; opacity: 0.7;">
        <div style="font-size: 3em; margin-bottom: 16px;">ğŸ“­</div>
        <h3>ChÆ°a cÃ³ há»“ sÆ¡ vay nÃ o</h3>
        <p>Nháº¥n "Ná»™p há»“ sÆ¡ má»›i" Ä‘á»ƒ báº¯t Ä‘áº§u Ä‘Äƒng kÃ½ vay tÃ­n dá»¥ng</p>
        <a href="/apply" class="btn btn-primary" style="margin-top: 16px;">ğŸ“ Ná»™p há»“ sÆ¡ Ä‘áº§u tiÃªn</a>
    </div>

    <div th:each="app : ${apps}" class="app-card">
        <div class="app-header">
            <div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <strong>Há»“ sÆ¡ #<span th:text="${app.id}"></span></strong>
                    <span class="badge" th:text="${app.status}" th:class="'badge ' + ${app.status.name()}"></span>
                </div>
                <div class="app-amount" th:text="${#numbers.formatInteger(app.amount, 3, 'POINT')} + ' VND'"></div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.9em; opacity: 0.7;" th:text="${app.termMonths} + ' thÃ¡ng'"></div>
                <div style="font-size: 0.8em; opacity: 0.6;" th:text="${#temporals.format(app.submittedAt, 'dd/MM/yyyy')}"></div>
            </div>
        </div>

        <!-- Progress bar -->
        <div class="progress-bar">
            <div class="progress-fill" th:style="'width: ' +
                (${app.status.name() == 'SUBMITTED'} ? '20%' :
                 ${app.status.name() == 'UNDER_REVIEW'} ? '40%' :
                 ${app.status.name() == 'ASSESSED'} ? '60%' :
                 ${app.status.name() == 'APPROVED'} ? '80%' :
                 ${app.status.name() == 'DISBURSED'} ? '100%' : '0%')"></div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
            <div class="app-status">
                <span th:text="${app.status.name() == 'SUBMITTED' ? 'â³ ÄÃ£ ná»™p há»“ sÆ¡' :
                               (app.status.name() == 'UNDER_REVIEW' ? 'ğŸ” Äang tháº©m Ä‘á»‹nh' :
                               (app.status.name() == 'ASSESSED' ? 'âš–ï¸ Chá» quyáº¿t Ä‘á»‹nh' :
                               (app.status.name() == 'APPROVED' ? 'âœ… ÄÃ£ phÃª duyá»‡t' :
                               (app.status.name() == 'DISBURSED' ? 'ğŸ’° ÄÃ£ giáº£i ngÃ¢n' :
                               (app.status.name() == 'REJECTED' ? 'âŒ ÄÃ£ tá»« chá»‘i' : 'KhÃ´ng xÃ¡c Ä‘á»‹nh')))))"></span>
            </div>
            <div style="display: flex; gap: 8px;">
                <a th:href="@{'/customer/app/' + ${app.id}}" class="btn btn-outline btn-sm">ğŸ‘ï¸ Chi tiáº¿t</a>
                <a th:if="${app.status.name() == 'APPROVED' or app.status.name() == 'DISBURSED'}"
                   th:href="@{'/admin/' + ${app.id} + '/contract'}" class="btn btn-outline btn-sm">ğŸ“„ Há»£p Ä‘á»“ng</a>
            </div>
        </div>

        <!-- Additional info for certain statuses -->
        <div th:if="${app.status.name() == 'REJECTED' and app.rejectionReason != null}"
             style="margin-top: 8px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 4px; border-left: 3px solid #ef4444;">
            <small><strong>LÃ½ do tá»« chá»‘i:</strong> <span th:text="${app.rejectionReason}"></span></small>
        </div>

        <div th:if="${app.status.name() == 'APPROVED'}"
             style="margin-top: 8px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 4px; border-left: 3px solid #22c55e;">
            <small>ğŸ‰ <strong>ChÃºc má»«ng!</strong> Há»“ sÆ¡ Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t. Äang chá» giáº£i ngÃ¢n.</small>
        </div>

        <div th:if="${app.status.name() == 'DISBURSED'}"
             style="margin-top: 8px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 4px; border-left: 3px solid #16a34a;">
            <small>âœ¨ <strong>HoÃ n táº¥t!</strong> Khoáº£n vay Ä‘Ã£ Ä‘Æ°á»£c giáº£i ngÃ¢n vÃ o ngÃ y <span th:text="${#temporals.format(app.disbursedAt, 'dd/MM/yyyy')}"></span></small>
        </div>
    </div>

    <!-- Help Section -->
    <div style="margin-top: 40px; padding: 20px; background: #0f172a; border-radius: 12px; border: 1px solid #374151;">
        <h3>â“ Cáº§n há»— trá»£?</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
            <div>
                <strong>ğŸ“ Hotline:</strong><br>
                <span style="color: #22d3ee;">1900-123-456</span>
            </div>
            <div>
                <strong>ğŸ“§ Email:</strong><br>
                <span style="color: #22d3ee;">support@bank.com</span>
            </div>
            <div>
                <strong>ğŸ• Giá» lÃ m viá»‡c:</strong><br>
                <span>T2-T6: 8:00-17:00</span>
            </div>
        </div>
    </div>
</div>

<script>
// Auto refresh every 60 seconds
setTimeout(() => location.reload(), 60000);

// Add click animation to app cards
document.querySelectorAll('.app-card').forEach(card => {
    card.addEventListener('click', function(e) {
        if (e.target.tagName !== 'A') {
            const detailBtn = card.querySelector('a[href*="/customer/app/"]');
            if (detailBtn) {
                detailBtn.click();
            }
        }
    });

    card.style.cursor = 'pointer';
});
</script>
</body>
</html>